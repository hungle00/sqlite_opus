<div class="row g-0" style="">
  <!-- Sidebar with tables -->
  <div class="col-md-2 sidebar">
    <div class="p-3">
      <h6 class="mb-3">
        <i class="fas fa-database"></i> <%= @database[:name] %>
      </h6>
      <%= link_to "â† Back to Databases", databases_path, class: "btn btn-sm btn-outline-secondary mb-3" %>

      <h6 class="mb-2">Tables</h6>
      <ul class="table-sidebar" data-controller="table-selector" data-database-id="<%= @database[:id] %>">
        <% @tables.each do |table| %>
          <%= link_to table_info_database_path(@database[:id], table_name: table), 
              class: "table-link", 
              data: { 
                turbo_frame: "table-info", 
                table_selector_target: "tableItem", 
                table_name: table,
                action: "click->table-selector#selectTable"
              } do %>
            <li>
              <i class="fas fa-table"></i> <%= table %>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>

  <!-- Main content area -->
  <div class="col-md-10 main-content" data-controller="query-executor" data-database-name="<%= @database[:name] %>">
    <!-- Query Console -->
    <div class="content-header">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h1 class="page-title mt-3 mx-4">
            <i class="fas fa-server"></i>
            <%= @database[:name] %>
          </h1>
        </div>
      </div>
      <div class="content-body mx-4">
        <%= turbo_frame_tag "table-info" do %>
          <table class="table table-sm table-striped table-bordered">
            <tbody>
              <tr>
                <td class="fw-semibold">Base Name</td>
                <td><%= @metadata.filename %></td>
              </tr>
              <tr>
                <td class="fw-semibold">Size on Disk</td>
                <td><%= @metadata.size_on_disk %></td>
              </tr>

              <tr>
                <td class="fw-semibold">Tables</td>
                <td><%= @metadata.tables.size %></td>
              </tr>

              <tr>
                <td class="fw-semibold">Indexes</td>
                <td><%= @metadata.get_all_indexes.size %></td>
              </tr>

              <tr>
                <td class="fw-semibold">Views</td>
                <td><%= @metadata.get_all_views.size %></td>
              </tr>
            </tbody>
          </table>
        <% end %>
      </div>
    </div>
    <div class="query-console">
      <%= form_with url: execute_query_database_path(@database[:id]),
                    method: :post,
                    data: {
                      action: "submit->query-executor#execute"
                    } do |form| %>
        <div class="mb-3">
          <label for="query" class="form-label fw-bold">SQL Query</label>
          <textarea name="query"
                    id="query"
                    class="form-control query-textarea"
                    data-query-executor-target="queryInput"
                    placeholder="Enter your SQL query here..."><%= params[:query] || "SELECT * FROM sqlite_master WHERE type='table';" %></textarea>
        </div>
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-play"></i> Execute Query
          </button>
          <button type="button" class="btn btn-outline-secondary" data-action="click->query-executor#clear">
            <i class="fas fa-eraser"></i> Clear
          </button>
          <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#saveQueryModal">
            <i class="fas fa-save"></i> Save Query
          </button>
          <%= link_to worksheet_path, class: "btn btn-outline-info" do %>
            <i class="fas fa-file-code"></i> SQL Worksheet
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Results Container -->
    <div class="results-container" id="query-results">
      <div class="text-muted text-center py-5">
        <i class="fas fa-database fa-3x mb-3"></i>
        <p>Execute a query to see results</p>
      </div>
    </div>

    <!-- Save Query Modal -->
    <div class="modal fade" id="saveQueryModal" tabindex="-1" aria-labelledby="saveQueryModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="saveQueryModalLabel">Save Query</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="query-name" class="form-label">Query Name *</label>
              <input type="text" class="form-control" id="query-name" data-query-executor-target="queryName" required>
            </div>
            <div class="mb-3">
              <label for="query-description" class="form-label">Description *</label>
              <textarea class="form-control" id="query-description" rows="2" data-query-executor-target="queryDescription" required></textarea>
            </div>
            <div id="save-error" class="alert alert-danger d-none" data-query-executor-target="saveError"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" data-action="click->query-executor#saveQuery">
              <i class="fas fa-save"></i> Save
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>