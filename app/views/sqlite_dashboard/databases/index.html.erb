<div class="databases-index-page">
  <div class="row g-0" style="min-height: 100vh;">
    <!-- Sidebar -->
    <div class="col-md-2 sidebar index-sidebar">
      <div class="p-3">
        <div class="sidebar-brand">
          <i class="fas fa-database"></i>
          <div>
            <h6 class="mb-0">SQLite Opus</h6>
            <small class="text-muted">Database Manager</small>
          </div>
        </div>

        <div class="sidebar-stats mt-4">
          <div class="stat-item">
            <i class="fas fa-server"></i>
            <div>
              <div class="stat-value"><%= @databases.count %></div>
              <div class="stat-label">Database<%= @databases.count != 1 ? 's' : '' %></div>
            </div>
          </div>
        </div>

        <% if @databases.any? %>
          <div class="mt-4">
            <h6 class="text-muted mb-2" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">Quick Access</h6>
            <ul class="database-list">
              <% @databases.each do |database| %>
                <li>
                  <%= link_to database_path(database[:id]), class: "database-link" do %>
                    <i class="fas fa-database"></i>
                    <span><%= database[:name] %></span>
                    <i class="fas fa-chevron-right ms-auto"></i>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Main content -->
    <div class="col-md-10" style="background-color: var(--main-bg); min-height: 100vh;">
      <div class="index-main-content">
        <div class="content-header">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h1 class="page-title mb-0">
                <i class="fas fa-server"></i>
                Your Databases
              </h1>
            </div>
            <div>
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <i class="fas fa-plus"></i> New Database
              </button>
              <%= link_to worksheet_path, class: "btn btn-success" do %>
                <i class="fas fa-file-code"></i> SQL Worksheet
              <% end %>
            </div>
          </div>
          <p class="page-subtitle">Select a database to explore and manage</p>
        </div>

        <%= render partial: 'sqlite_dashboard/databases/modals/upload_modal' %>

        <% if @databases.any? %>
          <div class="databases-grid">
            <% @databases.each do |database| %>
              <div class="database-card-modern">
                <div class="database-card-icon">
                  <i class="fas fa-database"></i>
                </div>
                <div class="database-card-content">
                  <h3 class="database-card-title"><%= database[:name] %></h3>
                  <p class="database-card-path">
                    <i class="fas fa-folder-open"></i>
                    <%= database[:path] %>
                  </p>
                </div>
                <div class="database-card-actions">
                  <%= link_to database_path(database[:id]), class: "btn btn-primary btn-card-action" do %>
                    <i class="fas fa-arrow-right"></i>
                    Open Dashboard
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>

          <!-- Saved Queries Section -->
          <% if @saved_queries.any? %>
            <div class="mt-5">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="h4">
                  <i class="fas fa-bookmark"></i> Recent Saved Queries
                </h2>
                <%= link_to worksheet_path, class: "btn btn-sm btn-outline-primary" do %>
                  <i class="fas fa-eye"></i> View All
                <% end %>
              </div>
              <div class="saved-queries-grid">
                <% @saved_queries.each do |query| %>
                  <div class="saved-query-card">
                    <div class="saved-query-header">
                      <h5 class="saved-query-title">
                        <i class="fas fa-code"></i> <%= query.name %>
                      </h5>
                      <% if query.database_name.present? %>
                        <span class="badge bg-info"><%= query.database_name %></span>
                      <% end %>
                    </div>
                    <p class="saved-query-description"><%= query.description %></p>
                    <div class="saved-query-sql">
                      <code><%= truncate(query.query, length: 100) %></code>
                    </div>
                    <div class="saved-query-meta">
                      <small class="text-muted">
                        <i class="fas fa-clock"></i> <%= time_ago_in_words(query.created_at) %> ago
                      </small>
                      <%= link_to worksheet_path, class: "btn btn-sm btn-outline-success" do %>
                        <i class="fas fa-play"></i> Load in Worksheet
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="empty-state-modern">
            <div class="empty-state-icon">
              <i class="fas fa-database"></i>
            </div>
            <h3>No Databases Configured</h3>
            <p>Configure databases in your application's initializer to get started</p>
            <div class="empty-state-code">
              <pre><code>SqliteDashboard.configure do |config|
  config.db_files = [
    { name: "Development", path: Rails.root.join("db/development.sqlite3").to_s },
    { name: "Production", path: Rails.root.join("db/production.sqlite3").to_s }
  ]
end</code></pre>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>